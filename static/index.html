<!DOCTYPE html>
<html>
<head>
    <title>Comment Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <style>
        .grid {
            display: grid;
            grid-template-columns: minmax(200px, 1fr) 400px;
            gap: 4px;
            margin-bottom: 8px;
            width: calc(100vw - 250px);
        }
        .grid > * {
            min-height: 12px;
            padding: 2px 4px;
            font-size: 14px;
            border: 1px solid #ddd;
            margin: 0;
        }
        .suggestions {
            position: absolute;
            border: 1px solid #ddd;
            background: white;
            max-height: 150px;
            overflow-y: auto;
            z-index: 100;
            width: 300px;
        }
        .suggestion {
            padding: 2px 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .suggestion:hover {
            background: #f0f0f0;
        }
        .edited {
            background-color: #fafafa;
        }
        .category-wrapper {
            position: relative;
        }
        .category-wrapper input {
          display: block;
          height: 100%;
        }
        .stats {
            position: fixed;
            right: 10px;
            top: 80px;
            background: white;
            border: 1px solid #ddd;
            padding: 8px;
            font-size: 12px;
            max-width: 200px;
            height: 100vh;
            overflow-y: scroll;
        }
        .stats h3 {
            margin: 0 0 4px 0;
            font-size: 14px;
        }
        textarea {
            resize: vertical;
            min-height: 12px;
            font-family: inherit;
            height: auto;
            font-size: inherit;
        }
        input {
            width: 100%;
            box-sizing: border-box;
            border: none;
            font-family: inherit;
            font-size: inherit;
        }
        button {
            font-size: 12px;
            padding: 0 4px;
            margin-left: 4px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="app">
      <div class="stats">
        <h3>Categories</h3>
        <div 
             v-for="stat in categoryStats" 
             :key="stat.category"
             @click="categoryFilter = categoryFilter === stat.category ? '' : stat.category"
             style="cursor: pointer"
             :style="{ fontWeight: categoryFilter === stat.category ? 'bold' : 'normal' }"
             >
             {{ stat.category }} ({{ stat.count }})
        </div>
      </div>
          <div class="grid" style="position: sticky; top: 0; background: white; padding: 8px; border-bottom: 1px solid #ddd; margin-bottom: 8px; z-index: 100;">
            <input 
               type="text" 
               v-model="filterText" 
               placeholder="Filter comments..."
               style="width: 300px; padding: 4px; border: 1px solid #ddd;"
               >
               <input 
               type="text" 
               v-model="categoryFilter" 
               placeholder="Filter categories..."
               style="width: 300px; padding: 4px; border: 1px solid #ddd; margin-left: 8px;"
               >
          </div>

               <div>
                 <div v-for="comment in filteredComments" :key="comment.id">
                   <div class="grid" :class="{ edited: comment.edited }">
                     <textarea 
                        rows="1"
                        style="resize: none;"
                        v-model="comment.comment" 
                        @input="e => { debouncedSave(comment); adjustTextareaHeight(e); }"
                        @focus="adjustTextareaHeight"
                        ></textarea>
                     <div class="category-wrapper">
                       <input 
                          type="text" 
                          v-model="comment.category"
                          @input="showSuggestions(comment)"
                          @blur="hideSuggestionsDelayed"
                          @keydown.esc="hideSuggestions"
                          @focus="showSuggestions(comment)"
                          >
                          <!-- <button @click="splitComment(comment)">Split</button>-->
                          <div v-if="comment.showSuggestions && getFilteredCategories(comment).length" class="suggestions">
                            <div 
                                                                                                       v-for="cat in getFilteredCategories(comment)" 
                                                                                                       :key="cat"
                                                                                                       class="suggestion"
                                                                                                       @mousedown.prevent="selectCategory(comment, cat)"
                                                                                                       >
                                                                                                       {{ cat }}
                            </div>
                          </div>
                     </div>
                   </div>
                 </div>
               </div>
      </div>
    <script src="script.js"></script>
</body>
</html>
