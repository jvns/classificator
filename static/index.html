<!DOCTYPE html>
<html>
<head>
    <title>Comment Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <style>
        .grid {
            display: grid;
            grid-template-columns: minmax(200px, 1fr) 400px;
            gap: 4px;
            margin-bottom: 8px;
            width: calc(100vw - 250px);
        }
        .grid > * {
            min-height: 12px;
            padding: 2px 4px;
            font-size: 14px;
            border: 1px solid #ddd;
            margin: 0;
        }
        .suggestions {
            position: absolute;
            border: 1px solid #ddd;
            background: white;
            max-height: 150px;
            overflow-y: auto;
            z-index: 100;
            width: 300px;
        }
        .suggestion {
            padding: 2px 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .suggestion:hover {
            background: #f0f0f0;
        }
        .edited {
            background-color: #fafafa;
        }
        .category-wrapper {
            position: relative;
        }
        .category-wrapper input {
          display: block;
          height: 100%;
        }

        .stats h3 {
            margin: 0 0 4px 0;
            font-size: 14px;
        }
        textarea {
            resize: vertical;
            min-height: 12px;
            font-family: inherit;
            height: auto;
            font-size: inherit;
        }
        input {
            width: 100%;
            box-sizing: border-box;
            border: none;
            font-family: inherit;
            font-size: inherit;
        }
        button {
            font-size: 12px;
            padding: 0 4px;
            margin-left: 4px;
            vertical-align: middle;
        }
        #filters {
          position: sticky;
          top: 0;
          background: white;
          padding: 8px;
          margin-bottom: 8px;
          z-index: 100;
        }
        #comments {
          height: calc(100vh - 80px);
          overflow-y: scroll;
          width: calc(100vw - 250px);
        }
        #stats {
            position: fixed;
            right: 10px;
            top: 60px;
            background: white;
            border: 1px solid #ddd;
            padding: 8px;
            font-size: 12px;
            max-width: 200px;
            height: 100vh;
            overflow-y: scroll;
        }
        h3 {
          margin: 0;
        }
    </style>
</head>
<body>
    <div id="app">
      <datalist id="categories">
        <option v-for="category in getCategories()" :value="category"></option>
      </datalist>
      <div id="stats">
        <h3>Categories</h3>
          (sort by: <span 
           :style="{ fontWeight: sortKey === 'category' ? 'bold' : 'normal' }"
           style="cursor: pointer"
            @click="sortKey='category'">category</span> |
          <span @click="sortKey='count'"
            :style="{ fontWeight: sortKey === 'count' ? 'bold' : 'normal' }"
           style="cursor: pointer">count</span>)

        <div 
             v-for="stat in categoryStats" 
             :key="stat.category"
             @click="categoryFilter = categoryFilter === stat.category ? '' : stat.category"
             style="cursor: pointer"
             :style="{ fontWeight: categoryFilter === stat.category ? 'bold' : 'normal' }"
             >
             {{ stat.category }} ({{ stat.count }})
        </div>



      </div>
          <div id="filters" class="grid">
            <input 
               type="text" 
               v-model="filterText" 
               placeholder="Filter comments..."
               style="width: 300px; padding: 4px; border: 1px solid #ddd;"
               >
               <input 
               type="text" 
               v-model="categoryFilter" 
               placeholder="Filter categories..."
               list="categories"
               style="width: 300px; padding: 4px; border: 1px solid #ddd; margin-left: 8px;"
               >
          </div>

               <div id="comments">
                 <div v-for="comment in filteredComments" :key="comment.id">
                   <div class="grid" :class="{ edited: comment.edited }">
                     <!-- run adjustTextareaHeight on when the textarea is created -->
                     <textarea 
                        v-if="comment.editing" 
                        v-model="comment.comment"
                        ref="textareaRef"
                        @input="adjustTextareaHeight()"
                        @blur="e => {saveComment(comment); comment.editing = false; }"
                        ></textarea>
                     <div
                        v-else
                        @click="() => { 
                                 comment.editing = true;
                                 this.$nextTick(() => adjustTextareaHeight());
                                 }"
                        v-html="comment.comment.replace(/\n/g, '<br>')"
                        ></div>
            
                     <div class="category-wrapper">
                       <input type="text" 
                              v-model="comment.category"
                              @blur="saveComment(comment)"
                              list="categories"
                       >
                     </div>
                   </div>
                 </div>
               </div>
      </div>
    <script src="script.js"></script>
</body>
</html>
